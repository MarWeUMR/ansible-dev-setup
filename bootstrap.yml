---
- name: "Setup system"
  hosts: [ docker, vms ]

  tasks:

    - name: Ensure binaries directory exists
      ansible.builtin.file:
        path: "{{ ansible_user_dir }}/.local/bin"
        state: directory
        mode: "0755"

    - name: Ensure config directory exists
      ansible.builtin.file:
        path: "{{ ansible_user_dir }}/.config"
        state: directory
        mode: "0755"

    - name: Load variables based on OS
      ansible.builtin.include_vars:
        file: "vars/{{ ansible_distribution | lower }}/packages.yml"

    - name: Include tasks based on OS type
      ansible.builtin.include_tasks: "tasks/bootstrap/packages/{{ ansible_distribution | lower }}.yml"

    - name: Ensure ansible user directory exists
      become: true
      ansible.builtin.file:
        path: "{{ ansible_user_dir }}/.ansible"
        state: directory
        mode: "0755"

    - name: Set user shell to fish
      ignore_errors: true # this might not always work
      ansible.builtin.user:
        name: "{{ ansible_user_id }}"
        shell: /usr/bin/fish
        append: true
      become: true
      tags: user
